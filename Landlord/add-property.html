<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Add Property | RentEasy</title>
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body>

  <!-- Header -->
  <header>
    <nav>
      <div class="logo"><a href="../index.html" style="text-decoration: none; color: inherit;"> RentEasy</a></div>
      <ul class="nav-links">
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="#">Logout</a></li>
      </ul>
    </nav>
  </header>

  <!-- Add Property Form -->
  <section class="add-property-page">
    <h2>Add New Property</h2>
    <form id="propertyForm">
      <label for="title">Property Title:</label>
      <input type="text" id="title" name="title" required>

      <label for="location">Location:</label>
      <input type="text" id="location" name="location" required>

      <label for="price">Price (₦):</label>
      <input type="number" id="price" name="price" required>

      <label for="type">Property Type:</label>
      <select id="type" name="type" required>
        <option value="">Select type</option>
        <option value="room">Room</option>
        <option value="self-con">Self Contain</option>
        <option value="flat">Flat</option>
        <option value="duplex">Duplex</option>
      </select>

      <label for="description">Description:</label>
      <textarea id="description" name="description" rows="4" required></textarea>

      <label for="image">Upload Image:</label>
      <input type="file" id="image" accept="image/*" required />

      <!-- Image Preview -->
      <img id="imagePreview" src="" alt="Preview" style="display:none; width: 200px; margin-top: 10px;" />

      <button type="submit">Add Property</button>
    </form>
  </section>

  <script>
    const propertyForm = document.getElementById("propertyForm");
    const imageInput = document.getElementById("image");
    const imagePreview = document.getElementById("imagePreview");
    let base64Image = "";

    const currentUser = JSON.parse(localStorage.getItem("currentUser"));
    if (!currentUser || currentUser.role !== "landlord") {
      alert("Access denied. Please log in as a landlord.");
      window.location.href = "../login.html";
    }

    // Show image preview and save base64 to variable
    imageInput.addEventListener("change", function () {
      const file = this.files[0];
      const reader = new FileReader();
      if (file) {
        reader.onload = function () {
          base64Image = reader.result;
          imagePreview.src = base64Image;
          imagePreview.style.display = "block";
        };
        reader.readAsDataURL(file);
      }
    });

    // Handle form submit
    propertyForm.addEventListener("submit", function (e) {
      e.preventDefault();

      const property = {
        title: document.getElementById("title").value,
        location: document.getElementById("location").value,
        price: document.getElementById("price").value,
        type: document.getElementById("type").value,
        description: document.getElementById("description").value,
        image: base64Image || "", // ✅ use base64 encoded image
        landlordEmail: currentUser.email,
        createdAt: new Date().toISOString()
      };

      let properties = JSON.parse(localStorage.getItem("properties")) || [];
      properties.push(property);
      localStorage.setItem("properties", JSON.stringify(properties));

      alert("✅ Property added successfully!");
      propertyForm.reset();
      imagePreview.src = "";
      imagePreview.style.display = "none";
      base64Image = "";
    });
  </script>

</body>
</html>
